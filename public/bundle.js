(()=>{"use strict";class t{}class s{constructor(t,s){this.spriteArray=t,this.lastIndex=0,this.delay=s,this.nowDelay=0}nextSprite(t){this.nowDelay+t>=this.delay?(this.lastIndex=(this.lastIndex+1)%this.spriteArray.length,this.nowDelay=this.nowDelay+t-this.delay):this.nowDelay+=t}nowSprite(){return this.spriteArray[this.lastIndex]}}class i extends t{constructor(t,i,e,h,a,r){super(),this.width=t,this.height=i,this.posX=t/2,this.posY=e-i/2,this.state="RUNNING",this.jumpHeight=150,this.groundHeight=e,this.g=-3e3,this.v0=Math.sqrt(-2*this.g*this.jumpHeight),this.timeToLand=2*this.v0*1e3/this.g,this.timeInTheAir=0,this.runSprites=new s(h,r),this.duckSprites=new s(a,r)}jump(t){this.state="JUMPING",this.timeInTheAir+=t,this.posY=this.groundHeight-(.5*this.g*this.timeInTheAir*this.timeInTheAir/1e6+this.v0*this.timeInTheAir/1e3)-this.height/2,this.posY>this.groundHeight-this.height/2&&(this.posY=this.groundHeight-this.height/2,this.state="RUNNING",this.timeInTheAir=0)}duck(t,s){this.state="DUCKING",this.height=s,this.width=t,this.posX=this.width/2,this.posY=this.groundHeight-this.height/2}unDuck(t,s){this.state="RUNNING",this.height=s,this.width=t,this.posX=this.width/2,this.posY=this.groundHeight-this.height/2}nextSprite(t){this.runSprites.nextSprite(t),this.duckSprites.nextSprite(t)}nowSprite(){switch(this.state){case"RUNNING":case"JUMPING":return this.runSprites.nowSprite();case"DUCKING":return this.duckSprites.nowSprite()}}}class e extends t{constructor(t,i,e,h,a,r){super(),this.width=t,this.height=i,this.posX=e,this.posY=h,this.sprites=new s(a,r)}move(t){this.posX-=t}nextSprite(t){this.sprites.nextSprite(t)}nowSprite(){return this.sprites.nowSprite()}}class h{constructor(){this.groundImg=new Image,this.groundImg.src="../../assets/images/ground.png",this.cactus1Img=new Image,this.cactus1Img.src="../../assets/sprites/cactus_1.png",this.cactus2Img=new Image,this.cactus2Img.src="../../assets/sprites/cactus_2.png",this.cactus3Img=new Image,this.cactus3Img.src="../../assets/sprites/cactus_3.png",this.cactusBig1Img=new Image,this.cactusBig1Img.src="../../assets/sprites/cactus_big_1.png",this.cactusBig2Img=new Image,this.cactusBig2Img.src="../../assets/sprites/cactus_big_2.png",this.cactusBig3Img=new Image,this.cactusBig3Img.src="../../assets/sprites/cactus_big_3.png",this.bird1Img=new Image,this.bird1Img.src="../../assets/sprites/bird_1.png",this.dino1Img=new Image,this.dino1Img.src="../../assets/sprites/dino_1.png",this.dinoDuck1Img=new Image,this.dinoDuck1Img.src="../../assets/sprites/dino_duck_1.png",this.bird2Img=new Image,this.bird2Img.src="../../assets/sprites/bird_2.png",this.dino2Img=new Image,this.dino2Img.src="../../assets/sprites/dino_2.png",this.dinoDuck2Img=new Image,this.dinoDuck2Img.src="../../assets/sprites/dino_duck_2.png",this.level1BirdHeight=34,this.level2BirdHeight=98,this.level3BirdHeight=162,this.canvas=document.getElementById("gamezone"),this.context=this.canvas.getContext("2d"),this.player=new i(this.dino1Img.width,this.dino1Img.height,this.canvas.height,[this.dino1Img,this.dino2Img],[this.dinoDuck1Img,this.dinoDuck2Img],333),this.obstacleArray=[],this.speed=7,this.acceleration=1e-4,this.score=0,this.offset=28}createObstacle(){switch(Math.round(8*Math.random())){case 0:return new e(this.cactus1Img.width,this.cactus1Img.height,this.canvas.width,this.canvas.height-this.cactus1Img.height/2,[this.cactus1Img],500);case 1:return new e(this.cactus2Img.width,this.cactus2Img.height,this.canvas.width,this.canvas.height-this.cactus2Img.height/2,[this.cactus2Img],500);case 2:return new e(this.cactus3Img.width,this.cactus3Img.height,this.canvas.width,this.canvas.height-this.cactus3Img.height/2,[this.cactus3Img],500);case 3:return new e(this.cactusBig1Img.width,this.cactusBig1Img.height,this.canvas.width,this.canvas.height-this.cactusBig1Img.height/2,[this.cactusBig1Img],500);case 4:return new e(this.cactusBig2Img.width,this.cactusBig2Img.height,this.canvas.width,this.canvas.height-this.cactusBig2Img.height/2,[this.cactusBig2Img],500);case 5:return new e(this.cactusBig3Img.width,this.cactusBig3Img.height,this.canvas.width,this.canvas.height-this.cactusBig3Img.height/2,[this.cactusBig3Img],500);case 6:return new e(this.bird1Img.width,this.bird1Img.height,this.canvas.width,this.canvas.height-this.level1BirdHeight,[this.bird1Img,this.bird2Img],333);case 7:return new e(this.bird1Img.width,this.bird1Img.height,this.canvas.width,this.canvas.height-this.level2BirdHeight,[this.bird1Img,this.bird2Img],333);case 8:return new e(this.bird1Img.width,this.bird1Img.height,this.canvas.width,this.canvas.height-this.level3BirdHeight,[this.bird1Img,this.bird2Img],333)}}moveWorld(t){0==this.obstacleArray.length&&this.obstacleArray.push(this.createObstacle());for(let s=0;s<this.obstacleArray.length;s++)this.obstacleArray[s].posX<0?this.obstacleArray.shift():this.obstacleArray[s].move(t);this.obstacleArray[this.obstacleArray.length-1].posX<=this.canvas.width/(2.7-Math.random())&&this.obstacleArray.push(this.createObstacle())}isCollide(t){return Math.abs(this.player.posX-t.posX)<(this.player.width+t.width)/2&&Math.abs(this.player.posY-t.posY)<(this.player.height+t.height)/2}isLose(){for(let t=0;t<this.obstacleArray.length;t++)if(this.isCollide(this.obstacleArray[t]))return!0;return!1}update(t,s){switch(s){case"JUMP":this.player.jump(t);break;case"DUCK":this.player.duck(this.dinoDuck1Img.width,this.dinoDuck1Img.height);break;case"UNDUCK":this.player.unDuck(this.dino1Img.width,this.dino1Img.height)}this.player.nextSprite(t);for(let s=0;s<this.obstacleArray.length;s++)this.obstacleArray[s].nextSprite(t);this.moveWorld(this.speed),this.speed+=this.acceleration,this.score+=this.speed*t}drawFrame(){this.context.drawImage(this.groundImg,0,this.canvas.height-this.groundImg.height),this.context.drawImage(this.player.nowSprite(),this.player.posX-this.player.width/2,this.player.posY-this.player.height/2-this.offset);for(let t=0;t<this.obstacleArray.length;t++)this.context.drawImage(this.obstacleArray[t].nowSprite(),this.obstacleArray[t].posX-this.obstacleArray[t].width/2,this.obstacleArray[t].posY-this.obstacleArray[t].height/2-this.offset)}}class a{constructor(){this.canvas=document.getElementById("gamezone"),this.context=this.canvas.getContext("2d"),this.restartButtonImg=new Image,this.restartButtonImg.src="../../assets/images/restart_button.png",this.gameOverImg=new Image,this.gameOverImg.src="../../assets/images/game_over.png",this.offset=30}drawFrame(){this.context.drawImage(this.gameOverImg,this.canvas.width/2-this.gameOverImg.width/2,this.canvas.height/2-(this.gameOverImg.height+this.offset+this.restartButtonImg.height)/2),this.context.drawImage(this.restartButtonImg,this.canvas.width/2-this.restartButtonImg.width/2,this.canvas.height/2+this.offset/2)}}const r=new class{constructor(){this.scene=new h,this.gameOverScene=new a,this.isRunning=!0,this.highScore=0,this.inputQueue=[],this.userInput="NONE",this.scoreShow=document.getElementById("score"),this.highScoreShow=document.getElementById("highScore")}processInput(){switch(this.scene.player.state){case"JUMPING":this.userInput="JUMP";break;case"DUCKING":for(let t=0;t<this.inputQueue.length;t++)if("UNDUCK"==this.inputQueue[t]||"UNDUCK"==this.inputQueue[t])return this.userInput="UNDUCK",void(this.inputQueue=[]);this.userInput="DUCK";break;case"RUNNING":this.inputQueue.length>0?this.userInput=this.inputQueue[0]:this.userInput="NONE"}this.inputQueue=[]}update(t){this.isRunning&&this.scene.update(t,this.userInput),this.isRunning||"JUMP"!=this.userInput||(this.isRunning=!0,this.scene=new h),this.scene.isLose()&&(this.isRunning=!1,this.scene.score>this.highScore&&(this.highScore=this.scene.score))}drawFrame(){this.scene.drawFrame(),this.isRunning||this.gameOverScene.drawFrame(),this.scoreShow.innerHTML="Score: "+Math.round(this.scene.score/100),this.highScoreShow.innerHTML="High score: "+Math.round(this.highScore/100)}isKeyDown(t){32!=t.keyCode&&38!=t.keyCode||this.inputQueue.push("JUMP"),40==t.keyCode&&this.inputQueue.push("DUCK")}isKeyUp(t){40==t.keyCode&&this.inputQueue.push("UNDUCK")}};let n=window.performance.now(),c=0;document.addEventListener("keydown",(function(t){r.isKeyDown(t)})),document.addEventListener("keyup",(function(t){r.isKeyUp(t)})),requestAnimationFrame((function t(s){c=s-n,r.processInput(),function(t){r.update(t)}(c),r.drawFrame(),n=s,requestAnimationFrame(t)}))})();